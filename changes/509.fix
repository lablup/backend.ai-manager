Update type annotations and correct typing errors additionally found by pyright and latest mypy
